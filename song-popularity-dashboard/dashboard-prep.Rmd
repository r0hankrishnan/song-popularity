---
title: "ShinyAppPrep"
author: "Rohan Krishnan"
date: "2024-06-12"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(randomForest)
library(kableExtra)
songs <- read.csv("~/Documents/GitHub/song-popularity/data/clean_data.csv")
songs %>% glimpse()
songs<- songs %>% select(-id)

unique(songs$mode)
```

```{r}
set.seed(100)
#Create random forest
rf.mod <- randomForest(popularity ~ ., data = songs,
                       mtry = 5, ntree = 501, importance = TRUE)

saveRDS(rf.mod, "~/Documents/GitHub/song-popularity/song-popularity-dashboard/randomforest.RDS")

```


```{r}
testData <- data.frame(
      duration_ms = 50000,
      explicit = TRUE,
      danceability = 0.25,
      energy = 0.25,
      key = 3,
      loudness = -50,
      mode = 1,
      speechiness = 0.25,
      acousticness = 0.25,
      instrumentalness = 0.25,
      liveness = 0.25,
      valence = 0.25,
      tempo = 153,
      time_signature = 4,
      track_genre = "pop")

popularity <- predict(rf.mod, testData)

dData <- cbind(popularity, testData)

dData %>%
  gather(key = "key", value = "value", popularity:track_genre) %>%
  mutate(key = str_replace(key,"_", " ") %>% str_to_title()) %>%
  kable(digits = 2, format.args = list(big.mark = ",")) 
  

dData %>%
  t() %>%
  as.data.frame() %>%
  rownames_to_column() %>%
  rename(Attribute = "rowname",
         Value = "1") %>%
  kable() 
```

```{r}
library(scales)

songs %>%
      ggplot(aes(x = duration_ms, y = popularity)) + 
      geom_point() + 
      geom_point(aes(x = dData$duration_ms, y = dData$popularity), color = "red") + 
      scale_x_continuous(labels = label_number()) + 
      labs(x = "Duration (ms)", y = "Popularity") 
```

